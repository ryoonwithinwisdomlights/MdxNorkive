---
title: Next.js 15 + Notion + ìºì‹œ ì‹œìŠ¤í…œì„ ì‹¤ì œë¡œ êµ¬í˜„í•˜ê¸° ìœ„í•œ ë‹¨ê³„ë³„ ê°€ì´ë“œ
slug: engineerings-Next-js-15-Notion-ìºì‹œ-ì‹œìŠ¤í…œì„-ì‹¤ì œë¡œ-
summary: ''
pageCover: >-
  https://images.unsplash.com/photo-1593062096033-9a26b09da705?ixlib=rb-4.0.3&q=85&fm=jpg&crop=entropy&cs=srgb
notionId: 2251eb5c03378095bcfbe19932b39768
password: ''
type: ENGINEERINGS
sub_type: TIL
category: TIL
tags:
  - caching
favorite: true
date: '2025-07-04'
last_edited_time: '2025-08-09T14:48:00.000Z'
lastEditedDate: 2025-08-09T14:48:00.000Z
draft: false
description: ''
icon: ''
full: false
lastModified: '2025-08-12'
readingTime: 29
wordCount: 5656
status: published
author: ryoonwithinwisdomlights
version: 1.0.0
---





> ğŸ¥°Â ìºìŠì „ëµí”Œë¡œìš°



<strong>âœ… Next.js + Notion + ìºì‹± ì „ëµ ì „ì²´ í”Œë¡œìš° (ë¡œì»¬ vs ìš´ì˜ + Vercel Cron)</strong>


```typescript
[Client (/blog ì ‘ê·¼)]
        â”‚
        â–¼
[Next.js 15 App Router â†’ Page Component]
        â”‚
        â–¼
[getPosts() í˜¸ì¶œ]
        â”‚
        â”œâ”€â”€ (ë¡œì»¬ ê°œë°œ í™˜ê²½)
        â”‚       â”‚
        â”‚       â–¼
        â”‚   [p-memoize / memory-cache ë“±]
        â”‚       â”‚
        â”‚       â””â”€â”€ ìºì‹œ miss ì‹œ
        â”‚               â”‚
        â”‚               â–¼
        â”‚          [Notion API fetch (notion-client)]
        â”‚
        â””â”€â”€ (ìš´ì˜ í™˜ê²½: Vercel)
                â”‚
                â–¼
            [Upstash Redis ìºì‹œ í™•ì¸]
                â”‚
                â””â”€â”€ ìºì‹œ miss ì‹œ
                        â”‚
                        â–¼
                   [Notion API fetch (notion-client)]

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[Vercel Cron Job (10ë¶„ë§ˆë‹¤ ì‹¤í–‰)]
        â”‚
        â–¼
[GET /api/cron/update-posts â†’ ë‚´ë¶€ì—ì„œ ë³€ê²½ì‚¬í•­ íƒì§€]
        â”‚
        â–¼
[ë³€ê²½ëœ post ë¸”ë¡ë§Œ ë‹¤ì‹œ fetch]
        â”‚
        â–¼
[Redis ìºì‹œ ê°±ì‹  (Upstash)]
```



<strong>âœ… ìš”ì•½ í¬ì¸íŠ¸</strong>



| <strong>êµ¬ë¶„</strong>       | <strong>ì „ëµ</strong>                                        |
| ------------ | --------------------------------------------- |
| <strong>ë¡œì»¬ ê°œë°œ</strong>    | p-memoize, memory-cache, Map ë“± in-memory ë°©ì‹   |</strong></strong>
| <strong>ìš´ì˜ ì„œë²„</strong>    | Upstash Redis ì‚¬ìš©í•˜ì—¬ Vercel í™˜ê²½ì—ì„œë„ ì§€ì†ë˜ëŠ” ìºì‹œ       |
| <strong>ìµœì‹ í™”</strong>      | Vercel Cron ìœ¼ë¡œ 10ë¶„ë§ˆë‹¤ Notion ë°ì´í„° ë³€í™” ê°ì§€ í›„ ìºì‹œ ê°±ì‹  |</strong></strong>
| <strong>Fallback</strong> | ìºì‹œ miss ì‹œì—ë§Œ notion-client ì§ì ‘ í˜¸ì¶œ (ì„œë²„ ì „ìš©)       |


ì´ ë¡œì§ì„ ê¸°ì¤€ìœ¼ë¡œí•œ <strong>Next.js 15 + Notion + ìºì‹œ ì‹œìŠ¤í…œ</strong>ì„ ì‹¤ì œë¡œ êµ¬í˜„í•˜ê¸° ìœ„í•œ <strong>ë‹¨ê³„ë³„ ê°€ì´ë“œëŠ” ì•„ë˜ì™€ ê°™ìŒ.</strong>



<strong>âœ… ì „ì²´ ì‘ì—… ìˆœì„œ ìš”ì•½</strong>



| <strong>ë‹¨ê³„</strong> | <strong>ëª©í‘œ</strong>                       | <strong>ì„¤ëª…</strong>                               |
| ------ | ---------------------------- | ------------------------------------ |
| 1ë‹¨ê³„    | Upstash Redis ì„¤ì •             | Vercelì—ì„œ ì“¸ ìˆ˜ ìˆëŠ” í´ë¼ìš°ë“œ Redis ì¸ìŠ¤í„´ìŠ¤ ì¤€ë¹„   |
| 2ë‹¨ê³„    | Redis ì—°ê²° ë° ìºì‹œ ìœ í‹¸ êµ¬í˜„          | ìš´ì˜í™˜ê²½ì—ì„œ Redis ìºì‹œë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•¨ìˆ˜ ì‘ì„±      |
| 3ë‹¨ê³„    | getPostBlocks ë¦¬íŒ©í† ë§           | ìºì‹±ì„ í¬í•¨í•œ Notion fetch í•¨ìˆ˜ë¡œ ë¦¬íŒ©í† ë§        |
| 4ë‹¨ê³„    | ë¡œì»¬/ìš´ì˜ ìºì‹œ ì „ëµ ë¶„ê¸°               | ê°œë°œí™˜ê²½ì—ì„œëŠ” memory-cache, ìš´ì˜í™˜ê²½ì€ Redis ì‚¬ìš© |
| 5ë‹¨ê³„    | Vercel Cron API ë§Œë“¤ê¸°          | ì£¼ê¸°ì ìœ¼ë¡œ Redis ìºì‹œë¥¼ ê°±ì‹ í•  route ìƒì„±         |
| 6ë‹¨ê³„    | Vercel Cron ì„¤ì •               | Vercel dashboardì—ì„œ 10ë¶„ ì£¼ê¸°ë¡œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •  |
| 7ë‹¨ê³„    | ISR(revalidate) ë³‘í–‰(optional) | ì¸ê¸° í˜ì´ì§€ëŠ” ìë™ ê°±ì‹ ë˜ë„ë¡ revalidate ì†ì„± í™œìš©    |


## <strong>ğŸ§© 1ë‹¨ê³„: Upstash Redis ì„¤ì • (Vercelì—ì„œ ì“¸ ì™¸ë¶€ ìºì‹œ)</strong>

1. [https://upstash.com](https://upstash.com/) ê°€ì…
2. Redis â†’ Create Database
3. REST URL, Token í™•ì¸
4. .env.localì— ì•„ë˜ í™˜ê²½ë³€ìˆ˜ ì¶”ê°€

```bash
UPSTASH_REDIS_REST_URL=your_upstash_url
UPSTASH_REDIS_REST_TOKEN=your_upstash_token
```


<strong>ğŸ§© 2ë‹¨ê³„: Redis ì—°ê²° ìœ í‹¸ ìƒì„±</strong>


```typescript
// lib/redis.ts
import { Redis } from "@upstash/redis";

export const redis = new Redis({
  url: process.env.UPSTASH_REDIS_REST_URL!,
  token: process.env.UPSTASH_REDIS_REST_TOKEN!,
});
```



<strong>ğŸ§© 3ë‹¨ê³„: getPostBlocks ë¦¬íŒ©í† ë§</strong>



```typescript
// lib/notion/getPostBlocks.ts
import { NotionAPI } from "notion-client";
import { redis } from "@/lib/redis";

export async function getPostBlocks(pageId: string) {
  const cacheKey = `postBlock_${pageId}`;

  const cached = await redis.get(cacheKey);
  if (cached) return cached;

  const notion = new NotionAPI({
    userTimeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
  });
  const data = await notion.getPage(pageId);

  await redis.set(cacheKey, data, { ex: 600 }); // 10ë¶„ TTL
  return data;
}
```



<strong>ğŸ§© 4ë‹¨ê³„: ë¡œì»¬/ìš´ì˜ ìºì‹œ ë¶„ê¸° ì²˜ë¦¬</strong>



```typescript
// lib/cache.ts
const memory = new Map();

export async function getCached<T>(
  key: string,
  fetcher: () => Promise<T>,
  ttl = 600
): Promise<T> {
  const isProd = process.env.NODE_ENV === "production";

  if (!isProd) {
    if (memory.has(key)) return memory.get(key);
    const fresh = await fetcher();
    memory.set(key, fresh);
    setTimeout(() => memory.delete(key), ttl * 1000);
    return fresh;
  }

  // ìš´ì˜ì—ì„œëŠ” Redis
  const cached = await redis.get<T>(key);
  if (cached) return cached;

  const fresh = await fetcher();
  await redis.set(key, fresh, { ex: ttl });
  return fresh;
}
```



<strong>ğŸ§© 5ë‹¨ê³„: Vercel Cronìš© API route ë§Œë“¤ê¸°</strong>



```typescript
// app/api/cron/update-posts/route.ts
import { getPostBlocks } from "@/lib/notion/getPostBlocks";
import { redis } from "@/lib/redis";
import { NextResponse } from "next/server";

const postPageIds = ["postid1", "postid2"]; // ë³€ê²½ ê°ì§€í•  í˜ì´ì§€ IDë“¤

export async function GET() {
  for (const id of postPageIds) {
    const data = await getPostBlocks(id);
    await redis.set(`postBlock_${id}`, data, { ex: 600 });
  }

  return NextResponse.json({ status: "refreshed" });
}
```



<strong>ğŸ§© 6ë‹¨ê³„: Vercel Cron ì„¤ì •</strong>


```json
{
  "path": "/api/cron/update-posts",
  "schedule": "*/10 * * * *"
}
//(10ë¶„ë§ˆë‹¤ ì‹¤í–‰ë¨)
```



<strong>ğŸ§© 7ë‹¨ê³„: ISR (revalidate = 600) ë³‘í–‰ ì‚¬ìš© (ì„ íƒ)</strong>


```bash
// app/blog/page.tsx

export const revalidate = 600; // í˜ì´ì§€ ìš”ì²­ ì‹œ 10ë¶„ ê²½ê³¼ë˜ë©´ ë°±ê·¸ë¼ìš´ë“œ regenerate

export default async function BlogPage() {
  const posts = await getPosts(); // ë‚´ë¶€ì—ì„œ Redis â†’ Notion í˜¸ì¶œ
  return <BlogList posts={posts} />;
}
```



<strong>âœ… ë§ˆë¬´ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸</strong>



| <strong>í•­ëª©</strong>                  | <strong>ì™„ë£Œ ì—¬ë¶€</strong> |
| ----------------------- | --------- |
| âœ… Upstash Redis ì—°ë™ ì™„ë£Œ   | â˜         |
| âœ… Redis ìºì‹œ ìœ í‹¸ ìƒì„±        | â˜         |
| âœ… Notion fetch ìºì‹± ì ìš©    | â˜         |
| âœ… Vercel/Local í™˜ê²½ ë¶„ê¸° ì ìš© | â˜         |
| âœ… cron route ìƒì„± ë° ë°°í¬    | â˜         |
| âœ… Vercel Cron Job ì„¤ì •    | â˜         |
| âœ… ISR ì ìš© (optional)     | â˜         |

