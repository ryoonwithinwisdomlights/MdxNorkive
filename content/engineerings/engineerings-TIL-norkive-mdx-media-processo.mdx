---
title: '[TIL] @norkive/mdx-media-processor íŒ¨í‚¤ì§€ ì„¤ê³„ì•ˆ'
slug: engineerings-TIL-norkive-mdx-media-processo
summary: ''
pageCover: >-
  https://res.cloudinary.com/dyrdul1dd/image/upload/v1762084289/norkive-notion-images/png_1762084288865_bm9ya2l2ZV.webp?format=webp&quality=90
notionId: 29f1eb5c0337807991c5c8286f9a3a06
password: ''
type: ENGINEERINGS
sub_type: TIL
category: TIL
tags:
  - ê°œë°œTIL
  - ê¸°ìˆ ë¡œê·¸
favorite: false
date: '2025-11-02'
lastEditedTime: '2025-11-02T08:06:00.000Z'
draft: false
description: ''
icon: ''
full: false
lastModifiedDate: '2025-11-02'
readingTime: 42
wordCount: 8281
status: published
author: ryoonwithinwisdomlights
version: 1.0.0
---

# @norkive/mdx-media-processor íŒ¨í‚¤ì§€ ì„¤ê³„ì•ˆ


## ğŸ¤” í˜„ì¬ ê³ ë¯¼ì‚¬í•­

1. <strong>ì´ë¦„ ì í•©ì„±</strong>:Â <code>image-optimizer</code>ëŠ” ë¬¸ì„œë„ ë‹¤ë£¨ëŠ”ë° ì í•©í•œê°€?
2. <strong>íŒŒì¼ ë¬¶ê¸°</strong>:Â <code>lib/utils/mdx-data-processing/cloudinary</code>Â í•˜ìœ„ íŒŒì¼ë“¤ì„ í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ë¡œ ë¬¶ëŠ” ê²Œ ë§ë‚˜?
3. <strong>lib/cloudinary.ts ì˜ì¡´ì„±</strong>: ë°˜ë“œì‹œ í¬í•¨ë˜ì–´ì•¼ í•˜ëŠ”ê°€?
4. <strong>cloudinaryConfig ì„¤ì •</strong>: ì–´ë–»ê²Œ ê¶Œìœ í•  ê²ƒì¸ê°€?

---


## ğŸ“Š í˜„ì¬ êµ¬ì¡° ë¶„ì„


### íŒŒì¼ êµ¬ì¡°


```plain text
lib/utils/mdx-data-processing/cloudinary/
â”œâ”€â”€ image-processor.ts        # Notion ì´ë¯¸ì§€ ì²˜ë¦¬
â”œâ”€â”€ document-processor.ts     # ë¬¸ì„œ ë§í¬ ì²˜ë¦¬ (PDF, DOC ë“±)
â”œâ”€â”€ enhanced-image-processor.ts # WebP ìµœì í™”
â””â”€â”€ index.ts                  # Export íŒŒì¼
```


### ì˜ì¡´ì„± ê´€ê³„


```plain text
image-processor.ts
  â”œâ”€ lib/cloudinary â†’ uploadImageFromUrl()
  â”œâ”€ lib/cache/image_cache_manager â†’ imageCacheManager
  â””â”€ constants/mdx.constants â†’ IMAGE_EXTENSIONS

document-processor.ts
  â”œâ”€ lib/cloudinary â†’ uploadPdfFromUrl()
  â”œâ”€ lib/cache/image_cache_manager â†’ imageCacheManager
  â”œâ”€ image-processor.ts â†’ isNotionImageOrFileUrl()
  â””â”€ constants/mdx.constants â†’ FILE_EXTENSIONS

enhanced-image-processor.ts
  â””â”€ (ì˜ì¡´ì„± ì—†ìŒ, URL ì¡°ì‘ë§Œ)
```


### lib/cloudinary.ts ë¶„ì„


<strong>í•µì‹¬ ê¸°ëŠ¥</strong>:

- Cloudinary SDK ì„¤ì • (<code>cloudinary.config()</code>)
- ì—…ë¡œë“œ í•¨ìˆ˜ë“¤ (<code>uploadImageFromUrl</code>,Â <code>uploadPdfFromUrl</code>Â ë“±)
- ìµœì í™” URL ìƒì„± (<code>getOptimizedImageUrl</code>)

<strong>ë¬¸ì œì </strong>:

- í”„ë¡œì íŠ¸ íŠ¹ì • ì„¤ì • ì§ì ‘ import (<code>EXTERNAL_CONFIG</code>)
- ì „ì—­ ì„¤ì • ì´ˆê¸°í™” (<code>initializeCloudinary()</code>)
- íŒ¨í‚¤ì§€ë¡œ ë§Œë“¤ê¸° ì–´ë ¤ìš´ êµ¬ì¡°

---


## âœ… í•´ê²° ë°©ì•ˆ


### 1. íŒ¨í‚¤ì§€ ì´ë¦„ ì œì•ˆ


<strong>ì¶”ì²œ</strong>:Â <code>@norkive/mdx-media-processor</code>


<strong>ì´ìœ </strong>:

- âœ… ì´ë¯¸ì§€ë¿ë§Œ ì•„ë‹ˆë¼ ë¬¸ì„œ(PDF, DOC ë“±)ë„ ì²˜ë¦¬
- âœ… "media"ëŠ” ì´ë¯¸ì§€ì™€ ë¬¸ì„œë¥¼ ëª¨ë‘ í¬ê´„
- âœ… MDX ì½˜í…ì¸ ì˜ ë¯¸ë””ì–´ ìì‚° ì²˜ë¦¬ë¼ëŠ” ëª©ì ì´ ëª…í™•

<strong>ëŒ€ì•ˆ</strong>:

- <code>@norkive/mdx-asset-processor</code>Â - ìì‚° ì²˜ë¦¬ ê´€ì 
- <code>@norkive/mdx-resource-processor</code>Â - ë¦¬ì†ŒìŠ¤ ì²˜ë¦¬ ê´€ì 
- <code>@norkive/mdx-cloudinary-processor</code>Â - Cloudinary íŠ¹í™” (í•˜ì§€ë§Œ Cloudinaryê°€ í•„ìˆ˜ëŠ” ì•„ë‹˜)

### 2. íŒŒì¼ ë¬¶ê¸° ì „ëµ


<strong>âœ… í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ë¡œ ë¬¶ëŠ” ê²ƒì´ ë§ìŠµë‹ˆë‹¤</strong>


<strong>ì´ìœ </strong>:

- ì„¸ íŒŒì¼ì´ ë°€ì ‘í•˜ê²Œ ì—°ê´€ë¨
- <code>document-processor.ts</code>ê°€Â <code>image-processor.ts</code>ì˜ í•¨ìˆ˜ë¥¼ ì¬ì‚¬ìš©
- í•¨ê»˜ ì‚¬ìš©ë˜ëŠ” ì‹œë‚˜ë¦¬ì˜¤ê°€ ë§ìŒ
- ë…¼ë¦¬ì ìœ¼ë¡œ í•˜ë‚˜ì˜ ê¸°ëŠ¥ ë‹¨ìœ„

<strong>íŒ¨í‚¤ì§€ êµ¬ì¡°</strong>:


```plain text
@norkive/mdx-media-processor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ processors/
â”‚   â”‚   â”œâ”€â”€ image-processor.ts
â”‚   â”‚   â”œâ”€â”€ document-processor.ts
â”‚   â”‚   â””â”€â”€ enhanced-image-processor.ts
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ constants.ts
â”‚   â””â”€â”€ index.ts
â””â”€â”€ package.json
```


### 3. lib/cloudinary.ts ì²˜ë¦¬ ë°©ì•ˆ


<strong>âŒ íŒ¨í‚¤ì§€ì— í¬í•¨í•˜ì§€ ì•ŠìŒ</strong>


<strong>ì´ìœ </strong>:

- í”„ë¡œì íŠ¸ íŠ¹ì • ì„¤ì •ì— ì˜ì¡´ì 
- ì „ì—­ ìƒíƒœ ì´ˆê¸°í™” í¬í•¨
- ì¬ì‚¬ìš©ì„±ì´ ë‚®ìŒ

<strong>ëŒ€ì‹  ì œì•ˆí•˜ëŠ” ë°©ì‹</strong>:


### ë°©ì•ˆ A: ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì£¼ì… (ì¶”ì²œ)


```typescript
// íŒ¨í‚¤ì§€ ë‚´ë¶€ ì¸í„°í˜ì´ìŠ¤ ì •ì˜export interface CloudinaryUploader {
  uploadImageFromUrl(url: string, fileName: string): Promise<CloudinaryUploadResult>;
  uploadPdfFromUrl(url: string, fileName: string): Promise<CloudinaryUploadResult>;
// ë˜ëŠ” í†µí•© í•¨ìˆ˜uploadFileFromUrl(url: string, fileName: string): Promise<CloudinaryUploadResult>;
}

// ì‚¬ìš©ìê°€ êµ¬í˜„ì²´ë¥¼ ì£¼ì…const processor = createMediaProcessor({
  uploader: {
    async uploadFileFromUrl(url, fileName) {
// ì‚¬ìš©ìì˜ Cloudinary ì„¤ì • ì‚¬ìš©return await uploadFileFromUrl(url, fileName);
    }
  }
});
```


### ë°©ì•ˆ B: Cloudinary SDK ì§ì ‘ ì‚¬ìš© (ëŒ€ì•ˆ)


```typescript
// íŒ¨í‚¤ì§€ê°€ Cloudinary SDKë¥¼ ì§ì ‘ ì‚¬ìš©// í•˜ì§€ë§Œ ì„¤ì •ì€ ì‚¬ìš©ìê°€ ì£¼ì…import { v2 as cloudinary } from 'cloudinary';

export function configureCloudinary(config: CloudinaryConfig) {
  cloudinary.config(config);
}

// ì„¤ì • í›„ ì‚¬ìš©configureCloudinary({
  cloud_name: process.env.CLOUDINARY_CLOUD_NAME,
  api_key: process.env.CLOUDINARY_API_KEY,
  api_secret: process.env.CLOUDINARY_API_SECRET,
});
```


<strong>ì¶”ì²œ</strong>: ë°©ì•ˆ A (ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì£¼ì…)

- ë” ìœ ì—°í•¨
- Cloudinary ì™¸ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ë„ ì‚¬ìš© ê°€ëŠ¥
- í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ì›€

### 4. ìºì‹œ ì²˜ë¦¬ ë°©ì•ˆ


<strong>ì„ íƒì  ì˜ì¡´ì„±ìœ¼ë¡œ ì œê³µ</strong>


```typescript
export interface CacheManager {
  getCachedImageUrl(originalUrl: string): Promise<string | null>;
  cacheImageUrl(originalUrl: string, cachedUrl: string, metadata?: any): Promise<void>;
}

// ìºì‹œ ì—†ì´ ì‚¬ìš© ê°€ëŠ¥const processor = createMediaProcessor({
  uploader: myUploader
});

// ìºì‹œì™€ í•¨ê»˜ ì‚¬ìš©const processor = createMediaProcessor({
  uploader: myUploader,
  cache: myCacheManager// ì„ íƒì 
});
```


<strong>Redis ì˜ì¡´ì„±</strong>:

- <code>peerDependencies</code>Â ë˜ëŠ”Â <code>optionalDependencies</code>ë¡œ ì„¤ì •
- ì‚¬ìš©ìê°€ Redis í´ë¼ì´ì–¸íŠ¸ë¥¼ ì£¼ì…

---


## ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ê³„


### íŒ¨í‚¤ì§€ëª…


<strong><code>@norkive/mdx-media-processor</code></strong>


### í¬í•¨ ë‚´ìš©


```plain text
âœ… í¬í•¨:
- image-processor.ts (ë¦¬íŒ©í† ë§ í•„ìš”)
- document-processor.ts (ë¦¬íŒ©í† ë§ í•„ìš”)
- enhanced-image-processor.ts
- í•„ìš”í•œ ìƒìˆ˜ (IMAGE_EXTENSIONS, FILE_EXTENSIONS)
- íƒ€ì… ì •ì˜

âŒ ì œì™¸:
- lib/cloudinary.ts (ì‚¬ìš©ìê°€ êµ¬í˜„ì²´ ì œê³µ)
- lib/cache/image_cache_manager.ts (ì„ íƒì  ì¸í„°í˜ì´ìŠ¤)
- í”„ë¡œì íŠ¸ íŠ¹ì • ì„¤ì •
```


### API ì„¤ê³„


```typescript
// 1. ì¸í„°í˜ì´ìŠ¤ ì •ì˜export interface MediaProcessorConfig {
  uploader: CloudinaryUploader;
  cache?: CacheManager;
  options?: {
    enableWebP?: boolean;
    quality?: number;
// ...
  };
}

// 2. í”„ë¡œì„¸ì„œ ìƒì„±export function createMediaProcessor(config: MediaProcessorConfig): MediaProcessor;

// 3. ì‚¬ìš©const processor = createMediaProcessor({
  uploader: {
    async uploadFileFromUrl(url, fileName) {
// ì‚¬ìš©ìì˜ Cloudinary ì—…ë¡œë“œ ë¡œì§return await uploadFileFromUrl(url, fileName);
    }
  },
  cache: myCacheManager,// ì„ íƒì options: {
    enableWebP: true,
    quality: 85
  }
});

// 4. ì²˜ë¦¬const processedContent = await processor.processNotionImages(content);
const processedDocs = await processor.processDocumentLinks(content);
```


### ì˜ì¡´ì„± ê´€ë¦¬


```json
{
  "name": "@norkive/mdx-media-processor",
  "version": "1.0.0",
  "dependencies": {},
  "peerDependencies": {
    "cloudinary": "^1.0.0"// ì„ íƒì },
  "optionalDependencies": {
    "redis": "^4.0.0"// ìºì‹œ ì‚¬ìš© ì‹œ}
}
```


---


## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ


### ê¸°ë³¸ ì‚¬ìš© (Cloudinary ì£¼ì…)


```typescript
import { createMediaProcessor } from '@norkive/mdx-media-processor';
import { uploadFileFromUrl } from './lib/cloudinary';// ì‚¬ìš©ì êµ¬í˜„const processor = createMediaProcessor({
  uploader: {
    uploadFileFromUrl: async (url, fileName) => {
      return await uploadFileFromUrl(url, fileName);
    }
  }
});

const processed = await processor.processNotionImages(mdxContent);
```


### ìºì‹œì™€ í•¨ê»˜ ì‚¬ìš©


```typescript
import { createMediaProcessor } from '@norkive/mdx-media-processor';
import { imageCacheManager } from './lib/cache';// ì‚¬ìš©ì êµ¬í˜„const processor = createMediaProcessor({
  uploader: myUploader,
  cache: {
    getCachedImageUrl: (url) => imageCacheManager.getCachedImageUrl(url),
    cacheImageUrl: (original, cached, meta) =>
      imageCacheManager.cacheImageUrl(original, cached, meta)
  }
});
```


### WebP ìµœì í™” í¬í•¨


```typescript
const processor = createMediaProcessor({
  uploader: myUploader,
  options: {
    enableWebP: true,
    quality: 85,
    progressive: true
  }
});
```


---


## ğŸ“‹ ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš


### 1ë‹¨ê³„: ì¸í„°í˜ì´ìŠ¤ ì •ì˜ ë° ë¦¬íŒ©í† ë§

1. <code>CloudinaryUploader</code>Â ì¸í„°í˜ì´ìŠ¤ ì •ì˜
2. <code>CacheManager</code>Â ì¸í„°í˜ì´ìŠ¤ ì •ì˜
3. ê¸°ì¡´ í•¨ìˆ˜ë“¤ì„ í´ë˜ìŠ¤/íŒ©í† ë¦¬ í•¨ìˆ˜ë¡œ ê°ì‹¸ê¸°
4. ì˜ì¡´ì„± ì£¼ì… êµ¬ì¡°ë¡œ ë³€ê²½

### 2ë‹¨ê³„: íŒ¨í‚¤ì§€ ìƒì„±

1. <code>packages/mdx-media-processor</code>Â ë””ë ‰í† ë¦¬ ìƒì„±
2. ì†ŒìŠ¤ ì½”ë“œ ì´ë™ ë° ë¦¬íŒ©í† ë§
3. íƒ€ì… ì •ì˜ ë¶„ë¦¬
4. ë¹Œë“œ ì„¤ì •

### 3ë‹¨ê³„: ì˜ì¡´ì„± ì •ë¦¬

1. Cloudinary ê´€ë ¨ ì½”ë“œ ì œê±° (ì¸í„°í˜ì´ìŠ¤ë§Œ ë‚¨ê¹€)
2. Redis ê´€ë ¨ ì½”ë“œ ì œê±° (ì¸í„°í˜ì´ìŠ¤ë§Œ ë‚¨ê¹€)
3. ìƒìˆ˜ íŒŒì¼ ë¶„ë¦¬
4. í…ŒìŠ¤íŠ¸ ì‘ì„±

### 4ë‹¨ê³„: ë¬¸ì„œí™” ë° ë°°í¬

1. README ì‘ì„±
2. ì‚¬ìš© ì˜ˆì‹œ ë¬¸ì„œ
3. ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
4. npm ë°°í¬

---


## ğŸ”„ ê¸°ì¡´ ì½”ë“œì™€ì˜ í˜¸í™˜ì„±


### ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œ ì‚¬ìš©


```typescript
// ê¸°ì¡´ ë°©ì‹ (í”„ë¡œì íŠ¸ ë‚´ë¶€)import { processNotionImages } from '@/lib/utils/mdx-data-processing/cloudinary';

// ìƒˆ ë°©ì‹ (íŒ¨í‚¤ì§€ ì‚¬ìš©)import { createMediaProcessor } from '@norkive/mdx-media-processor';
import { uploadFileFromUrl } from '@/lib/cloudinary';

const processor = createMediaProcessor({
  uploader: { uploadFileFromUrl }
});
await processor.processNotionImages(content);
```


### í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€


ê¸°ì¡´ í•¨ìˆ˜ë“¤ì„ wrapperë¡œ ì œê³µ:


```typescript
// ê¸°ì¡´ í•¨ìˆ˜ëª… ìœ ì§€ (deprecated)export async function processNotionImages(content: string): Promise<string> {
  const processor = getDefaultProcessor();// ì‹±ê¸€í†¤ ë˜ëŠ” ì „ì—­return await processor.processNotionImages(content);
}
```


---


## âœ… ê²°ë¡ 


### íŒ¨í‚¤ì§€ëª…


<strong><code>@norkive/mdx-media-processor</code></strong>Â âœ…


### íŒŒì¼ ë¬¶ê¸°


<strong>í•˜ë‚˜ì˜ íŒ¨í‚¤ì§€ë¡œ ë¬¶ê¸°</strong>Â âœ…


### lib/cloudinary.ts ì²˜ë¦¬


<strong>ì¸í„°í˜ì´ìŠ¤ ê¸°ë°˜ ì£¼ì… ë°©ì‹</strong>Â âœ…


### ì„¤ì • ê´€ë¦¬


<strong>ì‚¬ìš©ìê°€ uploader êµ¬í˜„ì²´ ì œê³µ</strong>Â âœ…


### ìºì‹œ


<strong>ì„ íƒì  ì¸í„°í˜ì´ìŠ¤</strong>Â âœ…


---


<strong>ì‘ì„±ì¼</strong>: 2025-11-01Â <strong>ëª©ì </strong>: íŒ¨í‚¤ì§€ ì„¤ê³„ ë°©í–¥ì„± í™•ë¦½

